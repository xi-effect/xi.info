'use client';

import { useLayoutEffect, useRef } from 'react';
import { gsap } from 'gsap';

export const AnimationEng = ({ active }: { active: boolean }) => {
  const svgRef = useRef(null);

  useLayoutEffect(() => {
    if (!active) return;

    const ctx = gsap.context(() => {
      // берём все <path> внутри svg
      const paths = gsap.utils.toArray('path');

      const tl = gsap.timeline({ defaults: { ease: 'none' } });

      // добавляем общую задержку в 3 секунд перед началом анимации
      tl.add(() => {}, 4);

      paths.forEach((path: SVGPathElement) => {
        const length = path.getTotalLength();
        // получаем задержку из data-атрибута (в секундах)
        const delay = parseFloat(path.getAttribute('data-delay') || '0');

        // стартовое состояние — невидимая линия
        gsap.set(path, {
          strokeDasharray: length,
          strokeDashoffset: length,
        });

        // «рисуем» путь с возможной задержкой
        tl.to(
          path,
          {
            strokeDashoffset: 0,
            duration: length / 250, // скорость: 250 px/сек; подстройте по вкусу
          },
          `+=${delay}`, // добавляем задержку перед началом анимации
        );
      });
    }, svgRef);

    // очистка при размонтировании
    return () => ctx.revert();
  }, [active]);

  return (
    <svg
      ref={svgRef}
      width="234"
      height="142"
      viewBox="0 0 234 142"
      fill="none"
      className="absolute top-0 left-0 w-full h-full"
    >
      <path
        d="M171.624 133.806C179.84 139.373 189.354 141.995 196.824 141.178C209.796 139.764 220.683 134.098 230.674 126.15L230.675 126.149C232.808 124.455 233.139 121.889 231.965 119.844C230.724 117.707 227.818 116.902 225.042 118.432H225.043C222.323 119.95 219.759 121.773 217.164 123.578V123.579L216.612 123.955C210.891 127.781 204.542 129.85 197.846 131.033C193.999 131.715 190.274 131.387 186.573 130.148H186.572C180.974 128.26 175.998 125.341 171.83 121.133C162.042 111.251 160.247 94.6077 168.322 83.8828L168.714 83.377C176.242 73.9093 186.093 68.0062 198.614 67.749V67.748C202.838 67.6565 207.126 68.2852 210.858 70.7412L211.218 70.9844C212.648 71.9805 213.519 73.2599 213.797 74.7031C214.074 76.1405 213.752 77.6803 212.915 79.1846C212.126 80.6192 211.026 81.6271 209.852 82.4766C209.266 82.9001 208.655 83.289 208.056 83.6689C207.452 84.0515 206.859 84.4248 206.288 84.8291L206.287 84.8301L206.08 84.9814C203.998 86.5766 203.497 89.0138 204.534 90.9736L204.535 90.9756C205.563 92.9373 207.992 93.8947 210.676 93.2178V93.2168C213.698 92.4483 216.739 90.3458 219.154 87.5859C221.417 84.9997 223.094 81.8778 223.692 78.8242L223.798 78.2148C224.806 71.3396 221.732 65.1923 215.107 61.6074C208.897 58.2477 202.186 57.0097 195.239 57.915L194.566 58.0088C176.383 60.7463 162.916 69.8497 155.539 87.0957H155.54C155.312 87.6367 155.023 88.1448 154.708 88.6641C154.386 89.1945 154.049 89.7162 153.684 90.3408L153.518 90.624L153.192 90.585C147.272 89.875 141.834 88.6032 137.521 83.8086C135.307 81.348 132.357 79.4927 129.473 77.6143C128.189 76.7793 126.477 76.3154 124.879 76.1865H124.878C121.763 75.93 119.155 78.4774 119.562 81.502L119.561 81.5029C119.849 83.6252 120.59 85.9818 121.913 87.416H121.914C124.168 89.8677 126.878 92.1553 129.803 93.5723C131.815 94.5402 133.083 95.8044 133.819 97.333C134.549 98.8485 134.733 100.575 134.672 102.425C134.4 110.616 130.781 116.975 124 121.595H123.999C122.555 122.583 121.134 123.035 119.696 123C118.265 122.966 116.866 122.451 115.459 121.596L115.457 121.594C111.834 119.365 109.217 116.266 107.276 112.589C104.404 107.154 102.806 101.3 101.642 95.3457C100.731 90.7645 101.765 87.0229 104.307 82.9053C115.659 64.5159 121.509 44.3978 120.938 22.6885C120.807 17.9512 119.57 13.1976 118.472 8.4541V8.45215C118.07 6.68372 116.954 4.92867 115.742 3.41406L115.741 3.41211C113.162 0.166339 108.889 -0.489166 105.741 2.07617C103.625 3.80037 101.681 6.07555 100.573 8.4834C98.5582 12.8582 96.8882 17.457 95.6963 22.1318C90.9899 40.5586 89.3803 59.349 90.2051 78.3193C90.3138 80.8471 90.0177 82.9765 89.123 84.8047C88.2254 86.6389 86.7494 88.1215 84.5869 89.3984H84.5859C79.8604 92.1865 75.6863 92.9619 72.3271 91.542C69.0723 90.1661 66.7569 86.8031 65.4492 81.6904L65.3262 81.1904C64.0973 76.032 63.9204 70.8532 64.9482 65.6055V65.6045C65.6658 61.9908 65.5305 58.5739 63.8174 55.0693C59.6632 46.6434 52.7074 42.5057 43.7529 41.6797H43.752C31.5929 40.5469 20.7076 44.4675 11.3691 52.1152H11.3682C4.81099 57.4768 0.77346 64.5479 0.511719 73.29C0.158783 84.8214 7.66725 95.639 19.0439 100.009C30.5476 104.416 41.8834 101.689 49.7676 92.6133H49.7686C51.3749 90.768 52.8837 88.848 54.8379 86.4521L55.2832 85.9062L55.6514 86.5059C56.6457 88.1233 57.2399 89.0559 57.79 89.9951L57.7939 90.002C61.2559 96.1198 65.0728 99.8376 69.5947 101.412C74.1177 102.987 79.4514 102.454 86.0273 99.8369C87.5388 99.235 89.0722 98.6832 91.0352 97.9404L91.542 97.748L91.6924 98.2695C92.5614 101.284 93.0485 103.744 94.0078 106.057L94.0088 106.06C95.8372 110.543 97.6174 115.028 99.8301 119.26L100.278 120.104C103.015 125.173 107.404 128.712 112.587 131.362V131.363C118.029 134.149 123.267 133.904 128.41 130.626V130.627C136.97 125.162 142.44 117.61 144.24 107.547V107.546C144.637 105.336 144.833 103.117 145.116 100.892L145.16 100.547L145.498 100.468C147.109 100.091 148.532 100.119 149.829 100.547C151.123 100.973 152.251 101.784 153.298 102.907L153.402 103.02L153.426 103.171C153.724 105.085 153.931 107.029 154.328 108.976C156.557 119.781 163.417 128.245 171.624 133.806ZM100.272 64.3975C99.7755 55.9626 101.04 48.3215 102.145 40.8418V40.8408C103.282 33.1982 105.494 25.6974 107.3 18.2236V18.2197C107.368 17.9463 107.577 17.7873 107.717 17.6992C107.867 17.6049 108.058 17.5216 108.251 17.4414C108.657 17.2732 109.184 17.0767 109.858 16.7461L110.472 16.4453L110.573 17.1201C111.517 23.375 111.601 29.1079 110.843 34.7451L110.68 35.8711C109.274 44.9731 106.905 53.8624 103.518 62.458L103.515 62.4639C103.327 62.9237 102.944 63.2611 102.554 63.5723C102.137 63.9046 101.665 64.2393 101.105 64.7402L100.334 65.4316L100.272 64.3975ZM28.2402 92.0547H28.2334C23.6706 91.8812 18.8917 89.7188 15.1035 85.5322L14.7402 85.1211C12.1658 82.1379 10.6722 78.9063 10.3643 75.5654C10.0561 72.2223 10.9393 68.8135 13.043 65.4873C14.719 62.8382 16.9064 60.2371 19.4531 58.4023H19.4541C25.4559 54.0902 32.3344 51.7812 39.7422 51.3359C44.0351 51.0754 47.9553 52.2709 51.3457 54.9062V54.9072C52.7443 55.9958 53.8357 57.2609 54.4053 58.7441C54.9431 60.1449 54.9999 61.6999 54.4648 63.416L54.3506 63.7617C51.3624 72.257 47.2678 80.1958 41.3369 87.0547V87.0557L41.0449 87.3828C38.0933 90.5987 34.1876 92.0889 28.7861 92.0625L28.2402 92.0547Z"
        stroke="white"
      />
    </svg>
  );
};
