'use client';

import { useLayoutEffect, useRef } from 'react';
import { gsap } from 'gsap';

export const AnimationChem = ({ active }: { active: boolean }) => {
  const svgRef = useRef(null);

  useLayoutEffect(() => {
    if (!active) return;

    const ctx = gsap.context(() => {
      // берём все <path> внутри svg
      const paths = gsap.utils.toArray('path');

      const tl = gsap.timeline({ defaults: { ease: 'none' } });

      // добавляем общую задержку в 3 секунд перед началом анимации
      tl.add(() => {}, 2);

      paths.forEach((path: SVGPathElement) => {
        const length = path.getTotalLength();
        // получаем задержку из data-атрибута (в секундах)
        const delay = parseFloat(path.getAttribute('data-delay') || '0');

        // стартовое состояние — невидимая линия
        gsap.set(path, {
          strokeDasharray: length,
          strokeDashoffset: length,
        });

        // «рисуем» путь с возможной задержкой
        tl.to(
          path,
          {
            strokeDashoffset: 0,
            duration: length / 120, // скорость: 250 px/сек; подстройте по вкусу
          },
          `+=${delay}`, // добавляем задержку перед началом анимации
        );
      });
    }, svgRef);

    // очистка при размонтировании
    return () => ctx.revert();
  }, [active]);

  return (
    <svg
      ref={svgRef}
      width="265"
      height="185"
      viewBox="0 0 265 185"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      className="absolute top-0 left-0 w-full h-full"
    >
      <path
        d="M24.2002 184.466C24.3195 184.513 24.4411 184.516 24.5996 184.44C24.7326 184.377 24.8957 184.254 25.085 184.042L25.2832 183.8C26.2145 182.563 26.8781 180.704 27.2949 178.324C27.7102 175.953 27.8729 173.11 27.8369 169.945C27.7649 163.616 26.8985 156.054 25.708 148.51C23.3275 133.425 19.6629 118.475 18.5215 113.721L18.3799 113.135L18.9824 113.105C28.7042 112.621 39.017 112.352 47.998 107.291L48.6191 106.94L48.7363 107.645C49.7245 113.585 50.4499 119.595 51.1914 125.584C51.8407 130.828 52.5028 136.058 53.3662 141.229L53.749 143.442C53.9167 144.373 56.2789 153.165 59.1367 160.205C59.8497 161.961 60.5896 163.6 61.3301 164.974C62.0747 166.355 62.8038 167.438 63.4844 168.109C64.1822 168.798 64.6898 168.927 65.0654 168.786C65.5012 168.623 66.0514 168.015 66.584 166.51C66.6219 166.402 66.654 166.161 66.6465 165.744C66.6393 165.343 66.5967 164.83 66.5215 164.215C66.3711 162.985 66.0935 161.379 65.7217 159.505C64.9784 155.759 63.8676 150.972 62.6777 146.028C60.3033 136.163 57.6057 125.639 56.9297 121.634C56.3204 118.035 52.769 96.4625 48.7412 76.1309C46.7269 65.963 44.5957 56.1173 42.6562 48.9883C41.6854 45.4195 40.7677 42.5538 39.9443 40.6729C39.5296 39.7254 39.156 39.0678 38.835 38.6953C38.674 38.5086 38.5561 38.4298 38.4883 38.4023C38.4443 38.3845 38.4371 38.3911 38.4219 38.3994L38.417 38.4014L38.3301 38.4541C38.1274 38.5943 37.9239 38.8535 37.7432 39.2861C37.5382 39.7768 37.3841 40.4412 37.2852 41.2744C37.0875 42.9395 37.1222 45.1846 37.3379 47.8477C37.7688 53.1675 38.9146 60.0569 40.292 67.0957C41.6687 74.1306 43.2729 81.2989 44.6152 87.1729C45.9546 93.0337 47.0399 97.6316 47.3691 99.4932L47.459 100.002L46.9473 100.075C45.4225 100.293 43.2555 100.986 40.7275 101.853C38.2201 102.712 35.3826 103.732 32.5742 104.567C29.7675 105.402 26.9526 106.064 24.4785 106.199C22.0174 106.333 19.7913 105.951 18.2676 104.581C16.7376 103.205 15.5374 101.157 14.5703 98.7744C13.6008 96.3857 12.8493 93.6207 12.2393 90.7725C11.0236 85.0965 10.3464 78.9662 9.64258 74.8037C8.93462 70.618 8.29234 66.3864 7.32812 62.334C7.01349 61.0084 6.2872 59.6555 5.39258 58.5137C4.49493 57.3681 3.46105 56.4766 2.56836 56.041C2.12136 55.8229 1.74702 55.7376 1.46191 55.7559C1.19925 55.7727 0.998676 55.8761 0.842773 56.0957C0.672113 56.3363 0.52889 56.7557 0.503906 57.4395C0.479188 58.1176 0.572419 59.0143 0.829102 60.168V60.1709C5.01626 79.523 9.62836 98.6347 13.6436 118.078C16.4873 131.852 18.8585 144.807 19.416 159.12C19.4492 159.95 19.9397 167.766 21.0186 174.569C21.5601 177.984 22.2413 181.086 23.0654 182.928C23.2697 183.384 23.4755 183.746 23.6777 184.009C23.8825 184.275 24.0602 184.41 24.2002 184.466Z"
        stroke="#B4B5BC"
      />
      <path
        d="M88.7407 147.041C90.3024 147.008 91.3961 146.269 92.3081 145.156C93.2429 144.016 93.9393 142.546 94.729 141.086C95.4951 139.669 96.3569 138.247 97.6118 137.429C98.8378 136.63 100.358 136.451 102.342 137.18L102.746 137.338C102.979 137.435 103.391 137.517 103.958 137.562C104.515 137.605 105.184 137.608 105.907 137.568C107.356 137.489 108.989 137.24 110.337 136.812C111.012 136.599 111.598 136.346 112.051 136.06C112.509 135.77 112.793 135.47 112.922 135.179C113.041 134.911 113.054 134.598 112.862 134.197C112.66 133.777 112.231 133.263 111.46 132.663C109.535 131.166 107.323 130.407 105.01 129.921C103.853 129.677 102.679 129.503 101.506 129.336C100.339 129.17 99.1664 129.009 98.0386 128.795L97.5698 128.706L97.6372 128.233C97.8739 126.577 98.0069 121.78 97.8384 115.811C97.6703 109.855 97.2038 102.778 96.2554 96.5752C95.7811 93.4736 95.1872 90.6014 94.4546 88.2021C93.7185 85.7914 92.8558 83.9058 91.8677 82.7383C91.3775 82.1592 90.8743 81.7776 90.3618 81.583C89.8578 81.3917 89.3134 81.3687 88.7075 81.5566C87.5391 81.9192 86.1272 83.0723 84.4683 85.3594L84.1323 85.832L84.0229 85.998C83.467 86.8731 82.7958 88.466 82.1792 90.4404C81.5262 92.5317 80.9499 95.0009 80.6431 97.3936C80.3351 99.795 80.3037 102.079 80.7114 103.817C81.1191 105.556 81.9232 106.614 83.1929 106.872L83.1938 106.871C83.8666 106.998 84.3467 106.857 84.7212 106.557C85.1176 106.238 85.4472 105.7 85.7104 104.944C86.2389 103.428 86.4241 101.271 86.5454 99.0283C86.6645 96.8268 86.7216 94.5374 87.0249 92.8828C87.1755 92.0613 87.3988 91.3159 87.7749 90.8037C87.9693 90.5391 88.2178 90.319 88.5327 90.1953C88.8505 90.0706 89.1931 90.0611 89.5454 90.1465H89.5464C89.9653 90.2484 90.3148 90.5172 90.603 90.8604C90.8918 91.2041 91.1438 91.651 91.3677 92.167C91.8155 93.1993 92.1833 94.5898 92.481 96.2051C93.0773 99.4417 93.4114 103.681 93.5103 108.009C93.6092 112.339 93.4723 116.778 93.1216 120.417C92.9463 122.236 92.7172 123.864 92.4341 125.183C92.1552 126.482 91.812 127.546 91.3774 128.185H91.3765C90.3816 129.646 87.08 134.564 85.4077 139.071C84.564 141.346 84.1818 143.398 84.6021 144.834C84.805 145.527 85.1941 146.073 85.8257 146.45C86.4695 146.834 87.4069 147.067 88.7407 147.041Z"
        stroke="#B4B5BC"
      />
      <path
        d="M201.727 102.813C204.516 103.882 207.396 103.532 210.148 101.308C212.93 99.0597 215.599 94.8793 217.831 88.2568C219.681 82.7661 220.301 72.8496 219.757 61.54C219.214 50.2514 217.516 37.6493 214.778 26.8252C213.41 21.4132 211.783 16.4558 209.917 12.334C208.048 8.20498 205.953 4.95026 203.666 2.90723C201.394 0.877622 198.963 0.066161 196.349 0.725586C193.696 1.39479 190.748 3.6028 187.537 7.86914L187.536 7.87109L187.275 8.22266C184.617 11.8985 182.989 17.0525 182.134 23.0566C181.252 29.2461 181.199 36.2903 181.652 43.4482C182.559 57.7646 185.488 72.4757 187.814 81.5859C189.203 87.0233 191.257 91.7951 193.686 95.4795C196.119 99.1719 198.901 101.731 201.727 102.813ZM206.019 94.7061C203.569 96.1188 200.925 96.2883 198.517 94.6152C196.302 93.0768 194.364 90.0304 192.913 85.1924L192.63 84.2012C188.315 68.3687 187.842 45.4656 188.106 28.7471C188.198 22.9798 189.159 18.6831 190.695 15.7627C192.237 12.8332 194.385 11.2502 196.822 11.0469C199.237 10.8456 201.794 12.0121 204.147 14.2637C206.507 16.5205 208.708 19.907 210.435 24.2705L210.434 24.2715C216.272 38.7348 218.241 59.6429 216.161 75.7402C215.608 80.0254 214.274 84.066 212.485 87.3799C210.701 90.6858 208.443 93.3073 206.019 94.7061Z"
        stroke="#B4B5BC"
      />
      <path
        d="M259.217 103.209C259.641 103.526 260.158 103.634 260.851 103.408V103.407C261.522 103.188 262.076 102.374 262.461 100.904C262.835 99.4787 263.002 97.6217 263.058 95.6436C263.114 93.6714 263.058 91.6094 263 89.7812C262.943 87.9671 262.882 86.3583 262.929 85.333C263.004 83.7137 263.273 80.3941 263.567 76.3398C263.861 72.2766 264.182 67.4581 264.36 62.8164C264.538 58.1703 264.574 53.7186 264.303 50.3828C264.168 48.7112 263.958 47.3482 263.662 46.3887C263.513 45.908 263.351 45.5554 263.186 45.3213C263.022 45.0887 262.884 45.0148 262.788 44.9951C262.333 44.9083 261.958 44.9608 261.635 45.1084C261.306 45.259 261.001 45.5229 260.719 45.9033C260.148 46.6752 259.73 47.8527 259.43 49.2334C258.982 51.2976 258.825 53.6754 258.736 55.5098L258.662 57.1318C258.481 60.7039 258.264 63.4466 257.862 65.5557C257.46 67.664 256.865 69.1984 255.888 70.3086C254.904 71.4277 253.584 72.0576 251.86 72.4658C250.148 72.8712 247.98 73.0701 245.261 73.2881L244.601 73.3408L244.731 72.6914C246.175 65.482 246.032 51.7762 245.041 44.2617C244.792 42.3797 244.496 40.9302 244.174 40.0762C244.095 39.8659 244.019 39.7043 243.949 39.5869C243.918 39.5349 243.889 39.4969 243.867 39.4688C243.732 39.6241 243.547 39.9671 243.335 40.5918C243.125 41.2129 242.905 42.0604 242.677 43.165C242.222 45.3733 241.747 48.57 241.266 52.96C240.602 59.0239 240.106 63.9535 240.025 67.8789C239.943 71.8177 240.284 74.6662 241.234 76.6133C242.158 78.5069 243.681 79.5905 246.141 79.959C248.644 80.3339 252.092 79.9609 256.782 78.8994L257.396 78.7607L257.392 79.3906C257.385 80.3636 257.221 82.5445 257.087 85.1641C256.952 87.8052 256.844 90.9339 256.944 93.8701C257.044 96.8205 257.352 99.5213 258.022 101.336C258.358 102.245 258.762 102.869 259.217 103.209ZM262.878 44.5029C262.871 44.5015 262.863 44.5014 262.856 44.5C262.847 44.5203 262.839 44.5411 262.833 44.5615C262.837 44.5877 262.842 44.6147 262.849 44.6416L262.878 44.5029Z"
        stroke="#B4B5BC"
      />
      <path
        d="M144.204 117.659C152.154 121.714 160.567 118.369 167.202 111.223V111.222C172.868 105.103 176.438 98.297 176.934 91.7568C177.427 85.2474 174.88 78.9336 168.168 73.7295V73.7285C166.111 72.1323 163.714 70.6963 161.17 69.2471C158.636 67.8031 155.949 66.3428 153.363 64.7158C148.184 61.4585 143.31 57.4791 140.571 51.4043C138.58 46.9875 139.176 43.249 141.038 40.376C142.881 37.5304 145.937 35.575 148.819 34.6055V34.6045C149.402 34.4086 150.089 34.459 150.783 34.6143C151.486 34.7717 152.263 35.0526 153.063 35.3838C153.864 35.7156 154.709 36.1075 155.545 36.4912C156.387 36.877 157.221 37.2556 158.019 37.5723C158.818 37.8895 159.563 38.1368 160.223 38.2656C160.889 38.3955 161.423 38.3955 161.825 38.2646C162.201 38.1422 162.497 37.895 162.696 37.4277C162.904 36.9367 163.009 36.1884 162.922 35.082C162.564 30.5726 160.848 28.0504 158.531 26.8604C156.18 25.6531 153.076 25.7446 149.815 26.7705C146.565 27.7929 143.233 29.7217 140.494 32.0713C137.749 34.4257 135.641 37.165 134.777 39.7832V39.7852L134.573 40.4219C132.569 46.9589 133.815 52.2244 136.495 56.5137C139.276 60.9665 143.615 64.3856 147.551 67.0508C149.205 68.1694 151.281 69.2958 153.542 70.543C155.794 71.7847 158.214 73.1392 160.515 74.6992C165.11 77.8147 169.302 81.7991 170.74 87.4629C172.332 93.7298 168.572 99.6857 165.671 103.508H165.67C161.408 109.134 157.366 111.531 153.129 111.49C149.201 111.452 145.242 109.313 140.958 106.067L140.096 105.403C139.14 104.656 138.419 104.282 137.907 104.156C137.417 104.036 137.19 104.153 137.059 104.304C136.89 104.499 136.759 104.89 136.759 105.528C136.759 106.15 136.884 106.925 137.126 107.797C137.611 109.538 138.549 111.588 139.793 113.418C141.041 115.253 142.566 116.824 144.204 117.659Z"
        stroke="#B4B5BC"
      />
    </svg>
  );
};
